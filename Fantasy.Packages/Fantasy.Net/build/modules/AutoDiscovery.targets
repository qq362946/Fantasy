<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <FantasyConfigAutoDiscoveryEnabled Condition="'$(FantasyConfigAutoDiscoveryEnabled)' == ''">$(IsDirectFantasyNetReference)</FantasyConfigAutoDiscoveryEnabled>
  </PropertyGroup>
  <ItemGroup>
    <CompilerVisibleItemMetadata Include="AdditionalFiles" MetadataName="SourceItemGroup" />
  </ItemGroup>
  <Target Name="_FantasyInjectConfigToAdditionalFiles"
          BeforeTargets="GenerateMSBuildEditorConfigFileShouldRun"
          Condition="'$(FantasyConfigAutoDiscoveryEnabled)' == 'true' AND
                     '$(MSBuildProjectName)' != 'Fantasy.Net' AND
                     '$(MSBuildProjectName)' != 'Fantasy-Net'">
    <Message Text="[Fantasy.Net] Auto-discovering Fantasy.config in $(MSBuildProjectDirectory)"
             Importance="high"
             Condition="'$(FantasyConfigDiagnostics)' == 'true'" />

    <ItemGroup>
      <_FantasyConfigFiles Include="$(MSBuildProjectDirectory)/Fantasy.config" />
      <AdditionalFiles Include="@(_FantasyConfigFiles)" SourceItemGroup="FantasyConfig" />
    </ItemGroup>
    <Message Text="[Fantasy.Net] Found @(_FantasyConfigFiles->Count()) Fantasy.config file(s)"
             Importance="high"
             Condition="'$(FantasyConfigDiagnostics)' == 'true'" />
    <Message Text="[Fantasy.Net]   %(_FantasyConfigFiles.Identity)"
             Importance="high"
             Condition="'$(FantasyConfigDiagnostics)' == 'true' and '@(_FantasyConfigFiles)' != ''" />
  </Target>

</Project>
