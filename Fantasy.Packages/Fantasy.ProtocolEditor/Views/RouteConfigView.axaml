<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:Fantasy.ProtocolEditor.ViewModels"
             xmlns:models="using:Fantasy.ProtocolEditor.Models"
             mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="600"
             x:Class="Fantasy.ProtocolEditor.Views.RouteConfigView"
             x:DataType="vm:RouteConfigViewModel">

  <Grid RowDefinitions="Auto,*,Auto" Margin="10">

    <!-- é¡¶éƒ¨å·¥å…·æ  -->
    <Border Grid.Row="0" Background="#2D2D30" CornerRadius="4" Padding="10" Margin="0,0,0,10">
      <Grid ColumnDefinitions="*,Auto">
        <TextBlock Grid.Column="0"
                   Text="RouteType é…ç½®ç¼–è¾‘å™¨"
                   FontSize="16"
                   FontWeight="Bold"
                   VerticalAlignment="Center"/>
        <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="10">
          <TextBlock Text="{Binding FilePath}"
                     FontSize="12"
                     Foreground="#AAAAAA"
                     VerticalAlignment="Center"/>
          <Button Content="ä¿å­˜"
                  Command="{Binding SaveConfigCommand}"
                  IsEnabled="{Binding IsModified}"
                  Background="#007ACC"
                  Foreground="White"
                  Padding="15,5"/>
        </StackPanel>
      </Grid>
    </Border>

    <!-- ä¸­é—´ä¸»å†…å®¹åŒº -->
    <Grid Grid.Row="1" RowDefinitions="Auto,*">

      <!-- æ·»åŠ æ–°æ¡ç›®åŒºåŸŸ -->
      <Border Grid.Row="0" Background="#252526" CornerRadius="4" Padding="15" Margin="0,0,0,10">
        <Grid RowDefinitions="Auto,Auto,Auto,Auto" ColumnDefinitions="100,*,100,*,Auto">

          <!-- æ ‡é¢˜ -->
          <TextBlock Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="5"
                     Text="æ·»åŠ æ–°çš„ Route ç±»åž‹"
                     FontSize="14"
                     FontWeight="Bold"
                     Margin="0,0,0,10"/>

          <!-- åç§°è¾“å…¥ -->
          <TextBlock Grid.Row="1" Grid.Column="0"
                     Text="åç§°:"
                     VerticalAlignment="Center"
                     Margin="0,0,10,0"/>
          <TextBox Grid.Row="1" Grid.Column="1"
                   Text="{Binding NewEntryName}"
                   Watermark="ä¾‹å¦‚: PlayerRouteType"
                   Margin="0,5"/>

          <!-- å€¼è¾“å…¥ -->
          <TextBlock Grid.Row="1" Grid.Column="2"
                     Text="å€¼:"
                     VerticalAlignment="Center"
                     Margin="20,0,10,0"/>
          <NumericUpDown Grid.Row="1" Grid.Column="3"
                         Value="{Binding NewEntryValue}"
                         Minimum="1001"
                         Maximum="999999"
                         Increment="1"
                         Margin="0,5"/>

          <!-- æ·»åŠ æŒ‰é’® -->
          <Button Grid.Row="1" Grid.Column="4"
                  Content="æ·»åŠ "
                  Command="{Binding AddEntryCommand}"
                  Background="#0E639C"
                  Foreground="White"
                  Padding="20,5"
                  Margin="10,5,0,5"/>

          <!-- è¯´æ˜Žæ–‡å­— -->
          <TextBlock Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="5"
                     Text="æç¤º: åç§°å¿…é¡»ä»¥ RouteType ç»“å°¾ï¼Œå€¼å¿…é¡» >= 1000 (1000ä»¥å†…æ¡†æž¶é¢„ç•™)"
                     FontSize="11"
                     Foreground="#AAAAAA"
                     Margin="0,5,0,0"/>

          <!-- é”™è¯¯ä¿¡æ¯ -->
          <TextBlock Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="5"
                     Text="{Binding ErrorMessage}"
                     FontSize="12"
                     Foreground="#F48771"
                     IsVisible="{Binding ErrorMessage, Converter={x:Static StringConverters.IsNotNullOrEmpty}}"
                     Margin="0,5,0,0"/>
        </Grid>
      </Border>

      <!-- å·²æœ‰æ¡ç›®åˆ—è¡¨ -->
      <Border Grid.Row="1" Background="#1E1E1E" CornerRadius="4">
        <Grid RowDefinitions="Auto,Auto,*">

          <!-- åˆ—è¡¨æ ‡é¢˜ -->
          <Border Grid.Row="0" Background="#2D2D30" Padding="10" BorderBrush="#3F3F46" BorderThickness="0,0,0,1">
            <TextBlock Text="å·²æ·»åŠ çš„ Route ç±»åž‹åˆ—è¡¨" FontSize="13" FontWeight="Bold"/>
          </Border>

          <!-- æœç´¢æ¡† -->
          <Border Grid.Row="1" Background="#252526" Padding="10" BorderBrush="#3F3F46" BorderThickness="0,0,0,1">
            <Grid ColumnDefinitions="Auto,*">
              <TextBlock Grid.Column="0"
                         Text="ðŸ”"
                         FontSize="14"
                         VerticalAlignment="Center"
                         Margin="0,0,8,0"/>
              <TextBox Grid.Column="1"
                       Text="{Binding SearchText}"
                       Watermark="æœç´¢åç§°æˆ–å€¼..."
                       Background="#1E1E1E"
                       BorderBrush="#3F3F46"
                       BorderThickness="1"
                       Padding="8,5"/>
            </Grid>
          </Border>

          <!-- åˆ—è¡¨å†…å®¹ -->
          <ScrollViewer Grid.Row="2" AllowAutoHide="False">
            <ScrollViewer.Styles>
              <Style Selector="ScrollBar">
                <Setter Property="Opacity" Value="1"/>
                <Setter Property="Transitions" Value="{x:Null}"/>
              </Style>
              <Style Selector="ScrollBar:vertical">
                <Setter Property="Transitions" Value="{x:Null}"/>
              </Style>
              <Style Selector="ScrollBar:horizontal">
                <Setter Property="Transitions" Value="{x:Null}"/>
              </Style>
            </ScrollViewer.Styles>
            <ItemsControl ItemsSource="{Binding FilteredEntries}">
              <ItemsControl.ItemTemplate>
                <DataTemplate DataType="models:RouteTypeEntry">
                  <Border Background="#252526"
                          Margin="5"
                          Padding="10"
                          CornerRadius="3"
                          BorderBrush="#3F3F46"
                          BorderThickness="1">
                    <Panel>
                      <!-- éžç¼–è¾‘æ¨¡å¼ -->
                      <Grid ColumnDefinitions="*,Auto,Auto,Auto" IsVisible="{Binding !IsEditing}">
                      <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="15">
                        <TextBlock Text="{Binding Name}"
                                   FontSize="13"
                                   FontWeight="SemiBold"
                                   VerticalAlignment="Center"
                                   Foreground="#4EC9B0"/>
                        <TextBlock Text="="
                                   VerticalAlignment="Center"
                                   Foreground="#AAAAAA"/>
                        <TextBlock Text="{Binding Value}"
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   Foreground="#B5CEA8"/>
                      </StackPanel>

                      <Button Grid.Column="1"
                              Content="ðŸ“‹ å¤åˆ¶"
                              Click="OnCopyNameClick"
                              Tag="{Binding Name}"
                              Background="#3E3E42"
                              Foreground="White"
                              Padding="10,3"
                              Margin="5,0"
                              ToolTip.Tip="å¤åˆ¶åç§°åˆ°å‰ªè´´æ¿"/>

                      <Button Grid.Column="2"
                              Content="ç¼–è¾‘"
                              Command="{Binding $parent[ItemsControl].((vm:RouteConfigViewModel)DataContext).EditEntryCommand}"
                              CommandParameter="{Binding}"
                              Background="#0E639C"
                              Foreground="White"
                              Padding="10,3"
                              Margin="5,0"/>

                      <Button Grid.Column="3"
                              Content="åˆ é™¤"
                              Command="{Binding $parent[ItemsControl].((vm:RouteConfigViewModel)DataContext).DeleteEntryCommand}"
                              CommandParameter="{Binding}"
                              Background="#C72E2E"
                              Foreground="White"
                              Padding="10,3"
                              Margin="5,0"/>
                      </Grid>

                      <!-- ç¼–è¾‘æ¨¡å¼ -->
                      <Grid ColumnDefinitions="100,*,100,*,Auto,Auto" IsVisible="{Binding IsEditing}">
                      <TextBlock Grid.Column="0"
                                 Text="åç§°:"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0"/>
                      <TextBox Grid.Column="1"
                               Text="{Binding Name}"
                               Margin="0,0,10,0"/>

                      <TextBlock Grid.Column="2"
                                 Text="å€¼:"
                                 VerticalAlignment="Center"
                                 Margin="0,0,10,0"/>
                      <NumericUpDown Grid.Column="3"
                                     Value="{Binding Value}"
                                     Minimum="1000"
                                     Maximum="999999"
                                     Margin="0,0,10,0"/>

                      <Button Grid.Column="4"
                              Content="ç¡®å®š"
                              Command="{Binding $parent[ItemsControl].((vm:RouteConfigViewModel)DataContext).ConfirmEditCommand}"
                              CommandParameter="{Binding}"
                              Background="#0E639C"
                              Foreground="White"
                              Padding="10,3"
                              Margin="5,0"/>

                      <Button Grid.Column="5"
                              Content="å–æ¶ˆ"
                              Command="{Binding $parent[ItemsControl].((vm:RouteConfigViewModel)DataContext).CancelEditCommand}"
                              CommandParameter="{Binding}"
                              Background="#3F3F46"
                              Foreground="White"
                              Padding="10,3"
                              Margin="5,0"/>
                      </Grid>
                    </Panel>
                  </Border>
                </DataTemplate>
              </ItemsControl.ItemTemplate>
            </ItemsControl>
          </ScrollViewer>

        </Grid>
      </Border>

    </Grid>

    <!-- åº•éƒ¨çŠ¶æ€æ  -->
    <Border Grid.Row="2" Background="#007ACC" CornerRadius="4" Padding="10" Margin="0,10,0,0"
            IsVisible="{Binding IsModified}">
      <TextBlock Text="æ–‡ä»¶å·²ä¿®æ”¹ï¼Œè¯·è®°å¾—ä¿å­˜"
                 FontSize="12"
                 Foreground="White"
                 FontWeight="Bold"/>
    </Border>

  </Grid>

</UserControl>
